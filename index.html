<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" /> 
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        
        <link type="text/css" rel="stylesheet" href="stylesheet.css"/>
        <title>math sprint</title>
    </head>

    <body>
        <div class="math-sprint-question">
            <div id="pre-equation">if&nbsp;</div>
            <div id="equation"></div>
            <br/>
            <div id="pre-expression">what is the value of&nbsp;</div>
            <div id="expression"></div>
            <div id="post-expression">&nbsp;?</div>
        </div>

        <form id="answer-submit" action="javascript:console.log()">
            <div class="answer-choice-row">
                <input class="answer-choices" id="answer-a" name="answer-choice-button" type="submit" value=""/>
                <input class="answer-choices" id="answer-b" name="answer-choice-button" type="submit" value=""/>
                <input class="answer-choices" id="answer-c" name="answer-choice-button" type="submit" value=""/>
                <input class="answer-choices" id="answer-d" name="answer-choice-button" type="submit" value=""/>
            </div>
        </form>

        <div class="math-sprint-response">
            <div id="user-answer"></div>
            <div class="choice-response" id="incorrect-chosen" visibility: hidden></div>
            <div class="choice-response" id="correct-chosen" visibility: hidden></div>

            <form id="next-question" action="javascript:console.log()" visibility: hidden>
                <input id="get-next-question" type="submit" value="next question" />
            </form>
        </div>

        <script>
            function shuffle(array) {
                // This shuffle array function is from user Blender: 
                // http://stackoverflow.com/questions/6274339/how-can-i-shuffle-an-array-in-javascript
                var counter = array.length, temp, index;
                while (counter > 0) {
                    index = Math.floor(Math.random() * counter);
                    counter--;
                    temp = array[counter];
                    array[counter] = array[index];
                    array[index] = temp;
                }
                return array;
            };

            function generateEquation() {
                var setRandomX = Math.floor(Math.random() * (21)) - 10;
                var setRandomY = Math.floor(Math.random() * (21)) - 10;
                return [setRandomX, setRandomY];
            };

            function generateExpression() {
                var setRandomX = Math.floor(Math.random() * (11)) - 5;
                var setRandomY = Math.floor(Math.random() * (11)) - 5;
                if ( setRandomX == 0 ) {
                    setRandomX = 1;
                }
                return [setRandomX, setRandomY];
            };

            function chooseWrongVariableValue() {
                var wrongVariableValue = Math.floor(Math.random() * (3)) - 0;
                return wrongVariableValue;
            }

            function generateAnswerChoices(equationValueX, equationValueY, expressionValueX, expressionValueY) {
                var correctVariableValue = equationValueY - equationValueX;

                
                var wrongVariableValue1 = equationValueX + equationValueY;
                var wrongVariableValue2 = correctVariableValue * (-1);
                var wrongVariableValue3 = wrongVariableValue1 * (-1);

                var wrongVariableValues = [wrongVariableValue1, wrongVariableValue2, wrongVariableValue3];

                var firstWrongVariableValueChoice = chooseWrongVariableValue();
                var nextWrongVariableValueChoice = chooseWrongVariableValue();
                var lastWrongVariableValueChoice = chooseWrongVariableValue();

                var choice1 = (wrongVariableValues[firstWrongVariableValueChoice] * expressionValueX) + expressionValueY;
                var choice2 = (wrongVariableValues[nextWrongVariableValueChoice] * expressionValueX) + expressionValueY;
                var choice3 = lastWrongVariableValueChoice;

                var correctAnswer = (expressionValueX * correctVariableValue) + expressionValueY;

                return [correctAnswer, choice1, choice2, choice3];
            };

            function createQuestionDisplay(equationValueX, equationValueY, expressionValueX, expressionValueY) {
                questionVariable = String.fromCharCode(Math.floor(Math.random() * (26)) + 97);

                var equationOrder = Math.floor(Math.random() * (2)) - 1;

                if ( equationOrder == 1 ) {
                    if ( equationValueX > 0 ) {
                        var questionEquation = questionVariable + " + " + equationValueX
                    }
                    else if ( equationValueX < 0 ) {
                        var questionEquation = questionVariable + " - " + Math.abs(equationValueX)
                    }
                    else {
                        var questionEquation = questionVariable
                    }
                }
                else {
                    if ( equationValueX == 0 ) {
                        var questionEquation = questionVariable
                        
                    }
                    else {
                        var questionEquation = equationValueX + " + " + questionVariable
                    }
                }

                if ( expressionValueX == 1 ) {
                    if ( expressionValueY > 0) {
                        var questionExpression = questionVariable + " + " + expressionValueY;
                    }
                    else if ( expressionValueY < 0) {
                        var questionExpression = questionVariable + " - " + Math.abs(expressionValueY);
                    }
                    else {
                        var questionExpression = questionVariable;
                    }
                }
                else if ( expressionValueX == (-1) ) {
                    if ( expressionValueY > 0) {
                        var questionExpression = "-" + questionVariable + " + " + expressionValueY;
                    }
                    else if ( expressionValueY < 0) {
                        var questionExpression = "-" + questionVariable + " - " + Math.abs(expressionValueY);
                    }
                    else {
                        var questionExpression = "-" + questionVariable;
                    }
                }
                else {
                    if ( expressionValueY > 0) {
                        var questionExpression = expressionValueX + questionVariable + " + " + expressionValueY;
                    }
                    else if ( expressionValueY < 0) {
                        var questionExpression = expressionValueX + questionVariable + " - " + Math.abs(expressionValueY);
                    }
                    else {
                        var questionExpression = expressionValueX + questionVariable;
                    }
                }

                return [questionEquation, questionExpression];
            };

            function displayQuestion() {
                var equationValues = generateEquation();
                var equationValueX = equationValues[0];
                var equationValueY = equationValues[1];

                var expressionValues = generateExpression();
                var expressionValueX = expressionValues[0];
                var expressionValueY = expressionValues[1];

                var answerChoices = generateAnswerChoices(equationValueX, equationValueY, expressionValueX, expressionValueY);

                correctAnswer = answerChoices[0];

                var testAnswers = [answerChoices[0], answerChoices[1], answerChoices[2], answerChoices[3]];
                var shuffledArray = shuffle(testAnswers);
                $( "#answer-a" ).val( shuffledArray[0] );
                $( "#answer-b" ).val( shuffledArray[1] );
                $( "#answer-c" ).val( shuffledArray[2] );
                $( "#answer-d" ).val( shuffledArray[3] );

                var questionEquationExpression = createQuestionDisplay(equationValueX, equationValueY, expressionValueX, expressionValueY);

                var questionEquation = questionEquationExpression[0];
                var questionExpression = questionEquationExpression[1];

                var displayOrder = Math.floor(Math.random() * (2)) - 1;

                if ( displayOrder == 1 ) {
                    $( "#equation" ).html( questionEquation + " = " + equationValueY + ",").show();
                    $( "#expression" ).html( questionExpression).show();
                }

                else {
                    $( "#equation" ).html( equationValueY + " = " + questionEquation + ",").show();
                    $( "#expression" ).html( questionExpression).show();
                }
            };

            displayQuestion();
            
            $( ".answer-choices" ).on('click', function () {
                var chosenAnswer = $(this).val();
                $( this ).addClass( "selected" );
                if ( chosenAnswer == correctAnswer ) {
                    $( "#correct-chosen" ).text( correctAnswer + " is the correct answer!").fadeIn(200);
                }
                else {
                   $( "#incorrect-chosen" ).text( chosenAnswer + " is not the correct answer.").fadeIn(200); 
                   $( "#correct-chosen" ).text( correctAnswer + " is the correct answer.").fadeIn(200);
                }
                $( "#next-question" ).fadeIn(200);
                return;
            });

            $( "#next-question" ).submit(function () {
                $( "#incorrect-chosen" ).fadeOut(300);
                $( "#correct-chosen" ).fadeOut(300);
                $( "#answer-field" ).val("");
                $( ".answer-choices" ).removeClass( "selected" );
                $( ".math-sprint-question" ).fadeOut(300).promise().done(function () {
                    displayQuestion();
                    $( ".math-sprint-question" ).fadeIn(200);
                });
                $( "#next-question" ).hide();
                return;
            }); 

        </script>
    </body>
</html>
